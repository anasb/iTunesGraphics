<html>
<title>Final Project - Computer Graphics ANAS BOUZOUBAA</title>
<body>

<!-- <center>
    <h2>Anas Bouzoubaa Final Project</h2>
    <input type="text" id="searchField" onkeydown="if (event.keyCode == 13) document.getElementById('btnSearch').click()"/>
    <button id="btnSearch" onclick="search();" href="javascript:;">Movie Search</button>
    <br />
    <br />
</center> -->

<link href="style/style.css" rel="stylesheet" type="text/css">
<script src="js/script.js"></script>
<script src="js/three.min.js"></script>
<script src="js/AnaglyphEffect.js"></script>
<script src="js/CSS3DRenderer.js"></script>
<script src="js/Projector.js"></script>
<script src="js/TrackballControls.js"></script>
<script src="js/THREEx.WindowResize.js"></script>
<script type='text/javascript' src='js/DAT.GUI.min.js'></script>

<center>
<div id="container" style="position: absolute; left:0px; top:0px"></div>
</div>
</center>

<script>

// standard global variables
var container, scene, camera, renderer, controls, stats, effect, movies;
var clock        = new THREE.Clock();
var anaglyphIsOn = false;
var animated     = false;

init();
animate();

function init() 
{
	this.scene = new THREE.Scene();

    // CAMERA
    var SCREEN_WIDTH, SCREEN_HEIGHT, VIEW_ANGLE, ASPECT, NEAR, FAR;
    SCREEN_WIDTH = window.innerWidth;
    SCREEN_HEIGHT = window.innerHeight;
    VIEW_ANGLE    = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1,FAR = 200000;
    camera        = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
    scene.add(camera);
    camera.position.set(0,0,400);
    camera.lookAt(scene.position);

    // RENDERER
    renderer = new THREE.WebGLRenderer( {antialias:true} );
    if (anaglyphIsOn) {
        effect = new THREE.AnaglyphEffect(renderer);
        effect.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        container = document.getElementById('container');
        container.appendChild(renderer.domElement);
        THREEx.WindowResize(effect, camera);
    } else {
        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        container = document.getElementById('container');
        container.appendChild(renderer.domElement);
        THREEx.WindowResize(renderer, camera);
    }

    // API function
    var getMovie = function httpGet(theURL) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theURL, false);
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }
    var searchTerm = 'doctor who';
    var limit = 60;
    movies = JSON.parse(getMovie("https://itunes.apple.com/search?term="+searchTerm+"&limit="+limit));
    
    function search() {
        clearPosters();
        var searchTerm = document.getElementById('searchField').value;
        movies = JSON.parse(getMovie("https://itunes.apple.com/search?term="+searchTerm+"&limit="+limit));
        draw();
    }

    // Clearing posters
    function clearPosters() {
        for (poster in postersArray) {
            scene.remove(poster);
        }
        postersArray = [];
    }

    //-------------------------------------------------------------
    //-------------------------------------------------------------
    
    // PLANE
    var bgTexture, bgMaterial, bgGeometry, bg;
    bgTexture       = THREE.ImageUtils.loadTexture("textures/sky.jpg");
    bgTexture.wrapS = bgTexture.wrapT = THREE.RepeatWrapping; 
    bgTexture.repeat.set(9, 9);
    bgMaterial      = new THREE.MeshBasicMaterial( { map: bgTexture, side: THREE.DoubleSide } );
    bgGeometry      = new THREE.PlaneBufferGeometry(SCREEN_WIDTH, SCREEN_HEIGHT, 10, 10);
    bg              = new THREE.Mesh(bgGeometry, bgMaterial);
    bg.position.z   = -200;
    scene.add(bg);

    // POSTERS
    var posterTexture, posterMaterial, posterGeometry, poster, posterImageURL;
    var postersArray = [];
    var MAX_PER_LINE = 10;
    var size         = 50;
    var lineNumber   = 0;
    var y            = 136;

    // Drawing posters
    for (var i = 0; i < movies.results.length; i++) {
        
        // Poster Plane
        posterImageURL          = movies.results[i].artworkUrl100;
        posterTexture           = THREE.ImageUtils.loadTexture(posterImageURL);
        posterTexture.minFilter = THREE.NearestFilter;
        posterMaterial          = new THREE.MeshBasicMaterial({map:posterTexture});
        posterGeometry          = new THREE.PlaneBufferGeometry(size, size);
        poster                  = new THREE.Mesh(posterGeometry, posterMaterial);
        
        // Grid Layout
        if (lineNumber >= MAX_PER_LINE) {
            lineNumber = 0;
            y -= size;
        }
        var x = -230 + lineNumber * size;
        poster.position.x = x;
        poster.position.y = y;
        lineNumber++;
        
        postersArray.push(poster);
        scene.add(poster);
    }
}

function render() 
{
    if (animated) {
        // Animate stuff
    }

    // Render (anagplyh / webgl)
    if (!anaglyphIsOn) {
        renderer.render(scene, camera);
    } else {
        effect.render(scene, camera);
    }
}

function animate() 
{
    requestAnimationFrame( animate );
    render();       
    update();
}

function update()
{
    // controls.update();
    // stats.update();
}
	// var render = function () {
	// 	time = (new Date().getTime()) / 1000;
	//  	requestAnimationFrame( render );

	// };
	// render();

</script>
</body>
</html>
