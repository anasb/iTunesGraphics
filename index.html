<html>
<title>Twitter Graphics</title>
<body>
<center><h2>Computer Graphics - Anas Bouzoubaa Final Project</h2></center>
<br/>

<link href="style/style.css" rel="stylesheet" type="text/css">
<script src="js/script.js"></script>
<script src="js/three.min.js"></script>
<script src="js/AnaglyphEffect.js"></script>

<center>
<div id='container'>
</div>
</center>

<script>
	this.scene = new THREE.Scene();

    var container, renderer, effect;
    var anaglyphIsOn    = false;
    var animated        = true;

    // CAMERA
    var SCREEN_WIDTH, SCREEN_HEIGHT, VIEW_ANGLE, ASPECT, NEAR, FAR, camera;
    SCREEN_WIDTH = 0.85 * screen.width;
    SCREEN_HEIGHT = 0.8 * screen.height;
    VIEW_ANGLE = 45, 
    ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, 
    NEAR = 0.1, 
    FAR = 20000;
    camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
    scene.add(camera);
    camera.position.set(0,150,400);
    camera.lookAt(scene.position);   

    // RENDERER
	container = document.getElementById('container');
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
    container.appendChild(renderer.domElement);
    renderer.setClearColor( 0xffffff, 1);
    renderer.shadowMapEnabled = true;
    renderer.shadowMapType = THREE.PCFSoftShadowMap;
    document.body.appendChild( renderer.domElement );
    
    // For 3D
    if (anaglyphIsOn) {
        effect = new THREE.AnaglyphEffect(renderer);
        effect.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
    }
    
    // LIGHT
    var light = new THREE.SpotLight( 0xffffff );
    // light.shadowCameraVisible = true; // for debugging light
    light.position.set( 600, 1000, 0 );
    light.distance = 100;
    light.castShadow = true;
    light.shadowMapWidth = 1024;
    light.shadowMapHeight = 1024;
    light.shadowCameraNear = NEAR;
    light.shadowCameraFar = FAR;
    light.shadowCameraFov = 30;
    light.shadowDarkness = 0.5;
    scene.add(light);

    // PLANE
    var floorTexture, floorMaterial, floorGeometry, floor;
    floorTexture = THREE.ImageUtils.loadTexture("textures/metal.jpg");
    floorTexture.needsUpdate = true;
    floorTexture.wrapS = floorTexture.wrapT = THREE.ClampToEdgeWrapping;
    floorTexture.minFilter = THREE.NearestFilter;
    floorMaterial = new THREE.MeshBasicMaterial( { map: floorTexture, side: THREE.DoubleSide } );
    floorGeometry = new THREE.PlaneBufferGeometry(1000, 1000, 10, 10);
    floor = new THREE.Mesh(floorGeometry, floorMaterial);
    floor.position.y = -0.5;
    floor.rotation.x = Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

	// CUBE
    var cubeTexture, cubeMaterial, cubeGeometry, cube;
	cubeTexture = THREE.ImageUtils.loadTexture("textures/funky.jpg");
    cubeTexture.needsUpdate = true;
    cubeTexture.wrapS = cubeTexture.wrapT = THREE.ClampToEdgeWrapping;
    cubeTexture.minFilter = THREE.NearestFilter; 
    cubeMaterial = new THREE.MeshBasicMaterial({ map: cubeTexture, side: THREE.DoubleSide });
    cubeGeometry = new THREE.BoxGeometry(100, 100, 100);
	cube = new THREE.Mesh( cubeGeometry, cubeMaterial );
    cube.position.z = -100;
    cube.rotation.x = 1;
    cube.rotation.y = 1;
    cube.castShadow = true;
	floor.add(cube);

	// RENDER
	var render = function () {
		time = (new Date().getTime()) / 1000;
	 	requestAnimationFrame( render );

        // Animate stuff
        if (animated) {
    	    cube.position.z = -100 + 20 * Math.sin(time);
        }

        // Render scene
        if (!anaglyphIsOn) {
            renderer.render(scene, camera);
        } else {
            effect.render(scene, camera);
        }
	};
	render();
</script>
</body>
</html>
